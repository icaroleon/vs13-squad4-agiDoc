-- COMPANY
CREATE TABLE VS_13_EQUIPE_4.COMPANY (
  	ID_COMPANY NUMBER(38, 0) NOT NULL,
  	COMPANY_NAME VARCHAR2(100) NOT NULL,
  	CNPJ VARCHAR2(14) UNIQUE NOT NULL,
    TYPE NUMBER(1,0) NOT NULL CHECK (type IN (0,1)),
    STATUS NUMBER(1,0) NOT NULL CHECK (status IN (0,1)),
  	CONSTRAINT PK_COMPANY PRIMARY KEY (ID_COMPANY)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_COMPANY
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- PROCESSES
CREATE TABLE VS_13_EQUIPE_4.PROCESSES (
  	ID_PROCESS NUMBER(38, 0) NOT NULL,
  	PROCESS_NUMBER VARCHAR2(255) NOT NULL,
  	TITLE VARCHAR2(100) NOT NULL,
  	DESCRIPTION VARCHAR2(255) NOT NULL,
  	STATUS NUMBER(1) NOT NULL CHECK (STATUS IN (0, 1, 2, 3)),
  	ID_COMPANY NUMBER(38, 0) NOT NULL,
  	CONSTRAINT PK_PROCESSES PRIMARY KEY (ID_PROCESS),
  	CONSTRAINT FK_PROCESSES_COMPANYS FOREIGN KEY (ID_COMPANY) REFERENCES VS_13_EQUIPE_4.COMPANY(ID_COMPANY),
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_PROCESSES
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- CONTACTS
CREATE TABLE VS_13_EQUIPE_4.CONTACTS (
  	ID_CONTACT NUMBER(38, 0) NOT NULL,
  	NAME VARCHAR2(100) NOT NULL,
  	EMAIL VARCHAR2(100) UNIQUE,
  	PHONE VARCHAR2(50) NOT NULL,
  	PHONE_TYPE NUMBER(1) NOT NULL CHECK (PHONE_TYPE IN (1, 2)),
  	CONSTRAINT PK_CONTACTS PRIMARY KEY (ID_CONTACT)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_CONTACTS
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- ADRESSES
CREATE TABLE VS_13_EQUIPE_4.ADDRESSES (
  	ID_ADDRESS NUMBER(38, 0) NOT NULL,
  	STREET VARCHAR2(255) NOT NULL,
  	DISTRICT VARCHAR2(255) NOT NULL,
  	"NUMBER" NUMBER(10, 0) NOT NULL,
  	COMPLEMENT VARCHAR2(255) NOT NULL,
  	CITY VARCHAR2(100) NOT NULL,
  	STATE VARCHAR2(100) NOT NULL,
  	ZIP_CODE VARCHAR2(8) NOT NULL,
  	CONSTRAINT PK_ADRESSES PRIMARY KEY (ID_ADDRESS)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_ADDRESSES
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- DEPARTMENTS
CREATE TABLE VS_13_EQUIPE_4.DEPARTMENTS (
	ID_DEPARTMENT NUMBER(38, 0) NOT NULL,
	ID_INSTITUTION NUMBER(38, 0),
	ID_COMPANY NUMBER(38, 0),
  	NAME VARCHAR2(255) NOT NULL,
   STATUS NUMBER(1,0) NOT NULL CHECK (status IN (0,1)),
  	CONSTRAINT CHK_DEPARTMENTS_ATRIBUTION CHECK ((CASE WHEN ID_COMPANY IS NOT NULL THEN 1 ELSE 0 END) = 1),
  	CONSTRAINT PK_DEPARTMENTS PRIMARY KEY (ID_DEPARTMENT),
  	CONSTRAINT FK_DEPARTMENTS_COMPANY FOREIGN KEY (ID_COMPANY) REFERENCES VS_13_EQUIPE_4.COMPANY(ID_COMPANY)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_DEPARTMENTS
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- USERS
CREATE TABLE VS_13_EQUIPE_4.USERS (
  	ID_USER NUMBER(38, 0) NOT NULL,
  	REGISTRATION VARCHAR2(100) UNIQUE NOT NULL,
  	NAME VARCHAR2(100) NOT NULL,
  	"USER" VARCHAR2(100) NOT NULL UNIQUE,
  	PASSWORD VARCHAR2(100) NOT NULL,
  	"ROLE" NUMBER(1,0) NOT NULL CHECK (role IN (0,1,2)),
  	"POSITION" VARCHAR2(100) NOT NULL,
   EMAIL VARCHAR2(100) NOT NULL UNIQUE,
   STATUS NUMBER(1,0) NOT NULL CHECK (status IN (0,1)),
  	ID_DEPARTMENT NUMBER(38, 8) NOT NULL,
  	CONSTRAINT PK_USERS PRIMARY KEY (ID_USER),
  	CONSTRAINT FK_USERS_DEPARTMENTS FOREIGN KEY (ID_DEPARTMENT) REFERENCES VS_13_EQUIPE_4.DEPARTMENTS(ID_DEPARTMENT)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_USERS
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- DOCUMENTS
CREATE TABLE VS_13_EQUIPE_4.DOCUMENTS (
  	ID_DOCUMENT NUMBER(38, 0) NOT NULL,
  	PROTOCOL VARCHAR2(50) UNIQUE NOT NULL,
  	EXPIRATION_DATE DATE NOT NULL,
   STATUS NUMBER(1,0) NOT NULL CHECK (status IN (0,1)),
  	IS_SIGNED NUMBER(1) NOT NULL CHECK (IS_SIGNED IN (0, 1)),
  	"FILE" BLOB, -- NOT NULL 
  	ID_SIGNATURE NUMBER(38, 0), -- IRÁ VIRAR UMA REFERÊNCIA DE UMA TABELA DE JUNÇÃO
  	CONSTRAINT PK_DOCUMENTS PRIMARY KEY (ID_DOCUMENT),
  	CONSTRAINT FK_DOCUMENTS_SIGNATURE FOREIGN KEY (ID_SIGNATURE) REFERENCES VS_13_EQUIPE_4.USERS(ID_USER)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_DOCUMENTS
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- CONTACTS ASSOCIATIONS
CREATE TABLE VS_13_EQUIPE_4.CONTACTS_ASSOCIATIONS (
  	ID_CONTACT_ASSOCIATION NUMBER(38, 0) NOT NULL,
  	ID_CONTACT NUMBER(38, 0) UNIQUE NOT NULL,
  	ID_COMPANY NUMBER(38, 0),
  	CONSTRAINT CHK_CONT_ASSO_ATRIBUTION CHECK ((CASE WHEN ID_COMPANY IS NOT NULL THEN 1 ELSE 0 END) = 1),
  	CONSTRAINT PK_CONTACTS_ASSOCIATIONS PRIMARY KEY (ID_CONTACT_ASSOCIATION),
  	CONSTRAINT FK_CONT_ASSO_CONTACTS FOREIGN KEY (ID_CONTACT) REFERENCES VS_13_EQUIPE_4.CONTACTS(ID_CONTACT),
  	CONSTRAINT FK_CONT_ASSO_COMPANYS FOREIGN KEY (ID_COMPANY) REFERENCES VS_13_EQUIPE_4.COMPANY(ID_COMPANY),
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_CONTACTS_ASSOCIATIONS
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- ADRESSES ASSOCIATIONS
CREATE TABLE VS_13_EQUIPE_4.ADDRESSES_ASSOCIATIONS (
  	ID_ADDRESS_ASSOCIATION NUMBER(38, 0) NOT NULL,
  	ID_ADDRESS NUMBER(38, 0) UNIQUE NOT NULL,
  	ID_COMPANY NUMBER(38, 0),
  	CONSTRAINT CHK_ADDR_ASSO_ATRIBUTION CHECK ((CASE WHEN ID_COMPANY IS NOT NULL THEN 1 ELSE 0 END) = 1),
  	CONSTRAINT PK_ADDRESSES_ASSOCIATIONS PRIMARY KEY (ID_ADDRESS_ASSOCIATION),
  	CONSTRAINT FK_ADDR_ASSO_ADDRESSES FOREIGN KEY (ID_ADDRESS) REFERENCES VS_13_EQUIPE_4.ADDRESSES(ID_ADDRESS),
  	CONSTRAINT FK_ADDR_ASSO_COMPANY FOREIGN KEY (ID_COMPANY) REFERENCES VS_13_EQUIPE_4.COMPANY(ID_COMPANY)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_ADDRESSES_ASSOCIATIONS
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;


-- DOCUMENTS ASSOCIATIONS
CREATE TABLE VS_13_EQUIPE_4.DOCUMENTS_ASSOCIATIONS (
  	ID_DOCUMENT_ASSOCIATION NUMBER(38, 0) NOT NULL,
  	ID_DOCUMENT NUMBER(38, 0) NOT NULL,
  	ID_COMPANY NUMBER(38, 0),
  	CONSTRAINT CHK_DOC_ASSO_ATRIBUTION CHECK ((CASE WHEN ID_COMPANY IS NOT NULL THEN 1 ELSE 0 END) = 1),
  	CONSTRAINT PK_DOCUMENTS_ASSOCIATIONS PRIMARY KEY (ID_DOCUMENT_ASSOCIATION),
 	CONSTRAINT FK_DOC_ASSO_DOCUMENTS FOREIGN KEY (ID_DOCUMENT) REFERENCES VS_13_EQUIPE_4.DOCUMENTS(ID_DOCUMENT),
  	CONSTRAINT FK_DOC_ASSO_COMPANY FOREIGN KEY (ID_COMPANY) REFERENCES VS_13_EQUIPE_4.COMPANY(ID_COMPANY)
);

CREATE SEQUENCE VS_13_EQUIPE_4.SEQ_DOCUMENTS_ASSOCIATIONS
START WITH 1
INCREMENT BY 1
NOCACHE NOCYCLE;

